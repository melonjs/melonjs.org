<!DOCTYPE html><html lang="en">
    <head>
        <title>melonJS</title>
        <meta name="description" content="melonJS is an open source HTML5 game engine">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" href="/img/favicon.svg">
    <link rel="stylesheet" href="/assets/f06e58b7.09b4cebd.css" />
<link rel="stylesheet" href="/assets/0602dd70.3e47f1f6.css" /></head>
    <body>
        <header class="astro-NCMDGNJ4">
    
    <nav class="astro-NCMDGNJ4">
        <ul class="astro-NCMDGNJ4">
            <li class="null astro-NCMDGNJ4">
                <a href="/#top" class="astro-NCMDGNJ4">Home</a>
            </li>
            <li class="astro-NCMDGNJ4">
                <a aria-label="NPM" href="https://www.npmjs.com/package/melonjs" class="astro-NCMDGNJ4"><svg class="icon npm inline no-bump astro-NCMDGNJ4" aria-hidden="true" focusable="false" version="1.1" id="npm" x="0px" y="0px" viewBox="0 0 780 250" style="enable-background:new 0 0 780 250;" xml:space="preserve" sodipodi:docname="npm.svg" inkscape:version="1.2 (dc2aeda, 2022-05-15)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" alt="npm"><defs    id="defs9" ></defs><sodipodi:namedview    id="namedview7"
   pagecolor="#ffffff"
   bordercolor="#000000"
   borderopacity="0.25"
   inkscape:showpageshadow="2"
   inkscape:pageopacity="0.0"
   inkscape:pagecheckerboard="0"
   inkscape:deskcolor="#d1d1d1"
   showgrid="false"
   inkscape:zoom="0.944"
   inkscape:cx="309.85169"
   inkscape:cy="125"
   inkscape:window-width="1309"
   inkscape:window-height="430"
   inkscape:window-x="0"
   inkscape:window-y="25"
   inkscape:window-maximized="0"
   inkscape:current-layer="npm" ></sodipodi:namedview>
<style    type="text/css"
   id="style2">
	.st0{fill:#C12127;}
</style>
<path    class="st0"
   d="M240,250h100v-50h100V0H240V250z M340,50h50v100h-50V50z M480,0v200h100V50h50v150h50V50h50v150h50V0H480z   M0,200h100V50h50v150h50V0H0V200z"
   id="path4"
   style="fill:#ffffff;fill-opacity:1" ></path>
</svg>
                </a>
            </li>
            <li class="astro-NCMDGNJ4"><a href="https://melonjs.github.io/docs/" class="astro-NCMDGNJ4">API</a></li>
            <li class="astro-NCMDGNJ4">
                <a href="https://github.com/melonjs/melonJS/wiki/made-with-melonJS" class="astro-NCMDGNJ4">Gallery
                </a>
            </li>
            <li class="astro-NCMDGNJ4">
                <a href="https://melonjs.discourse.group" class="astro-NCMDGNJ4"><svg class="icon discourse inline astro-NCMDGNJ4" aria-hidden="true" focusable="false" width="24px" height="24px" viewBox="0 0 24 24" role="img" xmlns="http://www.w3.org/2000/svg">
    <path         style="display:inline;fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:none"
        d="M12.103 0C18.666 0 24 5.485 24 11.997c0 6.51-5.33 11.99-11.9 11.99L0 24V11.79C0 5.28 5.532 0 12.103 0zm.116 4.563a7.395 7.395 0 0 0-6.337 3.57 7.247 7.247 0 0 0-.148 7.22L4.4 19.61l4.794-1.074a7.424 7.424 0 0 0 8.136-1.39 7.256 7.256 0 0 0 1.737-7.997 7.375 7.375 0 0 0-6.84-4.585h-.008z"
    ></path>
</svg>Forum
                </a>
            </li>
            <li class="astro-NCMDGNJ4">
                <a href="https://discord.gg/aur7JMk" target="_blank" class="astro-NCMDGNJ4"><svg class="icon discord inline astro-NCMDGNJ4" aria-hidden="true" focusable="false" width="71" height="55" viewBox="0 0 71 55" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0)">
<path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z" fill="#ffffff"></path>
</g>
<defs>
<clipPath id="clip0">
<rect width="71" height="55" fill="white"></rect>
</clipPath>
</defs>
</svg>Discord
                </a>
            </li>
            <li class="astro-NCMDGNJ4">
                <a href="https://github.com/melonjs/melonJS" class="astro-NCMDGNJ4"><svg class="icon github inline astro-NCMDGNJ4" aria-hidden="true" focusable="false" version="1.1" id="svg2" xml:space="preserve" width="161.03467" height="157.05838" viewBox="0 0 161.03467 157.05838" sodipodi:docname="GitHub-Mark.svg" inkscape:version="1.2 (dc2aeda, 2022-05-15)" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/"><metadata      id="metadata8"><rdf:RDF><cc:Work          rdf:about=""><dc:format>image/svg+xml</dc:format><dc:type            rdf:resource="http://purl.org/dc/dcmitype/StillImage" ></dc:type></cc:Work></rdf:RDF></metadata><defs      id="defs6"><clipPath        clipPathUnits="userSpaceOnUse"
       id="clipPath20"><path          d="M 0,551.986 H 530.973 V 0 H 0 Z"
         id="path18" ></path></clipPath></defs><sodipodi:namedview      pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1920"
     inkscape:window-height="1027"
     id="namedview4"
     inkscape:showpageshadow="2"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     showgrid="false"
     inkscape:zoom="1.2269333"
     inkscape:cx="34.63921"
     inkscape:cy="-15.893284"
     inkscape:window-x="0"
     inkscape:window-y="25"
     inkscape:window-maximized="0"
     inkscape:current-layer="g10" ></sodipodi:namedview><g      id="g10"
     inkscape:groupmode="layer"
     inkscape:label="GitHub-Mark"
     transform="matrix(1.3333333,0,0,-1.3333333,-382.88586,281.92253)"><path        d="m 0,0 c -33.347,0 -60.388,-27.035 -60.388,-60.388 0,-26.68 17.303,-49.316 41.297,-57.301 3.018,-0.559 4.126,1.31 4.126,2.905 0,1.439 -0.056,6.197 -0.082,11.243 -16.8,-3.653 -20.345,7.125 -20.345,7.125 -2.747,6.979 -6.705,8.836 -6.705,8.836 -5.479,3.748 0.413,3.671 0.413,3.671 6.064,-0.426 9.257,-6.224 9.257,-6.224 5.386,-9.231 14.127,-6.562 17.573,-5.019 0.543,3.902 2.107,6.567 3.834,8.075 -13.413,1.526 -27.513,6.705 -27.513,29.844 0,6.592 2.359,11.979 6.222,16.208 -0.627,1.522 -2.694,7.664 0.586,15.982 0,0 5.071,1.622 16.61,-6.191 4.817,1.338 9.983,2.009 15.115,2.033 5.132,-0.024 10.302,-0.695 15.128,-2.033 11.526,7.813 16.59,6.191 16.59,6.191 3.287,-8.318 1.22,-14.46 0.593,-15.982 3.872,-4.229 6.214,-9.616 6.214,-16.208 0,-23.195 -14.127,-28.301 -27.574,-29.796 2.166,-1.874 4.096,-5.549 4.096,-11.183 0,-8.08 -0.069,-14.583 -0.069,-16.572 0,-1.608 1.086,-3.491 4.147,-2.898 23.982,7.994 41.263,30.622 41.263,57.294 C 60.388,-27.035 33.351,0 0,0"
       style="display:inline;fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke:none"
       id="path202"
       transform="translate(347.5524,211.4419)" ></path></g></svg><span class="astro-NCMDGNJ4">GitHub
                    </span>
                </a>
            </li>
        </ul>
    </nav>
</header>
        <main class="md"><h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#optimization">How to optimize your game for performance</a></li>
<li><a href="#packaging">How to package your game for Windows, Mac, or Linux</a></li>
<li><a href="#property_access">How to access object properties or methods from another object</a></li>
<li><a href="#object_pooling">How to enable and use the object pooling feature</a></li>
<li><a href="#overlapping_touches">Handling mouse or touch events on multiple overlapping objects</a></li>
<li><a href="#form_inputs">Using form inputs in your game</a></li>
<li><a href="#collisions">Resolving collisions properly</a></li>
</ol>
<hr>
<h3 id="-1-how-to-optimize-your-game-for-performance"><a name="optimization"></a> <strong>1. How to optimize your game for performance :</strong></h3>
<ul>
<li>For tile maps, make sure to use a <a href="http://melonjs.github.io/melonJS/docs/me.sys.html#preRender">rendering method</a> adapted to your game, enabling it per layer (layers with sparse tiles should not have the pre rendering enabled). Layers with very few tiles draw faster dynamically, because only a few small draw operations occur, instead of one giant draw operation using mostly invisible pixels (context.drawImage() is not optimized for invisible pixels).</li>
<li>Enabling <a href="http://melonjs.github.io/melonJS/docs/me.video.html#init">double buffering</a> could help as well to decrease the amount of draw operations (works entirely with an off-DOM canvas and it is copied to the visible canvas at the end of the rendering cycle).</li>
<li>Using <a href="http://melonjs.github.io/melonJS/docs/me.pool.html">Object Pooling</a> will help reducing memory usage by reusing object and lowering the use of garbage collector.</li>
<li>Try 3rd party Application Wrappers solution like <a href="https://cordova.apache.org">Cordova</a> that provide Canvas accelerated environments on mobile devices.</li>
<li>If you use TexturePacker <a href="http://www.codeandweb.com/texturepacker/documentation#layout">disable</a> texture rotation, as it forces melonJS to apply a default rotation angle when drawing sprites and, based on how many sprites are to be displayed, can impact performance.</li>
<li>Use PNG images with alpha channel instead of the “transparent color” settings in Tiled tilesets. Even though the performance burden will occur only on load, you will notice it frequently if the map is loaded more than once while playing.</li>
<li>The game resolution is one of most important factor that influences the performance, try lowering the resolution in the call to <a href="http://melonjs.github.io/melonJS/docs/me.video.html#init">me.video.init</a>. Also it might be best to disable auto-scaling video.</li>
<li>Optimize your assets, using a Texture Atlas (like <a href="https://github.com/melonjs/melonJS/wiki/How-to-use-Texture-Atlas-with-TexturePacker">Texture Packer</a> or <a href="https://github.com/melonjs/melonJS/wiki/shoebox">Shoebox</a>) and unless you are certain to use only WebGL2, use fixed sized assets that are square and powers-of-2, like 512x512px, 1024x1024px, 4096x4096px or not square but powers-of-2, like 512x256px, 1024x512px, 4096x2048px (this optimize the use of GPU memory).</li>
<li>Optimize your Tiled maps, the same should be square and powers-of-2, like 512x512px, 1024x1024px, 4096x4096px or not square but powers-of-2, like 512x256px, 1024x512px, 4096x2048px (this also optimize the use of GPU memory).</li>
<li>For optimizing many entities (like characters) melonJS provides you with some useful features like culled updates (configurable with <a href="http://melonjs.github.io/melonJS/docs/me.Renderable.html#alwaysUpdate">me.Renderable.alwaysUpdate</a> - off by default, so off-screen entities do not use any additional CPU time for AI) and avoiding garbage collection stalls using entity pooling.</li>
<li>Avoid using the me.Text class more than necessary during in-game ; and rather use <a href="http://melonjs.github.io/melonJS/docs/me.BitmapText.html"><code>BitmapText</code></a>, especially when using WebGL.</li>
<li>There are a ton of good programming practices you can follow that will avoid unnecessary calculations. For example, it is faster to check an object property directly: <code>if (this.last_animation === "walk")</code> than it is to call a function that provides the same information: <code>if (this.isCurrentAnimation("walk"))</code></li>
<li>Avoid <code>Number.prototype.degToRad()</code> and friends - use radians directly to express rotation angles. For example, a full turn is always <code>Math.PI * 2</code>, a half turn is <code>Math.PI</code>, a quarter turn is <code>Math.PI * 0.5</code>, etc.</li>
<li>Try a lower fps rate. Does your game really require 60fps?</li>
<li>Use the Chrome JavaScript profiler or similar to locate problem areas.</li>
</ul>
<hr>
<h3 id="-2-how-to-package-your-game-for-windows-mac-or-linux"><a name="packaging"></a> <strong>2. How to package your game for Windows, Mac, or Linux :</strong></h3>
<ul>
<li>There are several solutions out-there, but one that is known to work very well with melonJS is <a href="https://github.com/rogerwang/node-webkit">Node-Webkit</a>, a stand-alone chromium wrapper that will let you package and distribute your games natively for Windows, Mac, and Linux.</li>
<li><a href="https://github.com/atom/electron">electron</a> is newer, more frequently updated, and backed by Github for Atom.</li>
<li><a href="https://github.com/adobe/brackets-shell">brackets-shell</a> is pretty much the same thing, made by Adobe for Brackets. This one is based on CEF, which is updated infrequently.</li>
<li>Another known solution is <a href="https://crosswalk-project.org/">cross-walk</a> that uses Chromium to provides the same HTML5 features and capabilities you would expect to find in most modern web browsers.</li>
</ul>
<hr>
<h3 id="-3-how-to-access-object-properties-or-methods-from-another-object"><a name="property_access"></a> <strong>3. How to access object properties or methods from another object :</strong></h3>
<ul>
<li>First step is to get a reference to the <em>target</em> object using <a href="http://melonjs.github.io/melonJS/docs/me.Container.html#getChildByName">me.game.world.getChildByName()</a>.</li>
<li><strong><code>me.game.world.getChildByName()</code> should only be called once</strong>, and the result saved to your game’s global namespace.</li>
<li>For example, to get a reference to an object named “player”, you should call <code>me.game.world.getChildByName()</code> in your <a href="http://melonjs.github.io/melonJS/docs/me.game.html#onLevelLoaded">onLevelLoaded</a> callback. If your global namespace is called <code>game</code> like in the <a href="https://github.com/melonjs/boilerplate">melonJS boilerplate</a>, save the result there:</li>
</ul>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">game.player </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> me.game.world.</span><span style="color: #D2A8FF">getChildByName</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'player'</span><span style="color: #C9D1D9">)[</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">]</span></span></code></pre>
<ul>
<li>The return value is an array. So when you have one player object, it will be the only element in the array.</li>
<li>Now you can access properties and methods on the “player” object through <code>game.player</code>:</li>
</ul>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// Get current player position</span></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> player_pos </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> game.player.pos</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">// call one of the player function</span></span>
<span class="line"><span style="color: #C9D1D9">game.player.</span><span style="color: #D2A8FF">foo</span><span style="color: #C9D1D9">()</span></span></code></pre>
<hr>
<h3 id="-4-how-to-enable-and-use-the-object-pooling-feature"><a name="object_pooling"></a> <strong>4. How to enable and use the object pooling feature :</strong></h3>
<p>Object Pooling allows you to greatly reduce the overhead of creating entities programmatically, and it is very useful with entities that are created and destroyed often (like bullet or laser entities). By using this feature, new instances of your entity won’t be created each time you need a new one (which increases memory usage and potentially slowing your game), but rather activated or pulled from the pool. When an entity is then destroyed, it is placed back into the pool to await the next request.</p>
<p>So, how to use this great stuff? Let’s have a look first at how to manually add an new entity (here <code>EntityLaser</code>) to the game manager:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// Create a new laser object</span></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> myLaser </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">new</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">EntityLaser</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'laser'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pos.x, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pos.y)</span></span>
<span class="line"><span style="color: #8B949E">// Add the laser to the game manager with z value 3</span></span>
<span class="line"><span style="color: #C9D1D9">me.game.world.</span><span style="color: #D2A8FF">addChild</span><span style="color: #C9D1D9">(myLaser, </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>Now to use entity pooling, the first thing is to associate a unique identifier to the object’s class within the entity pool. This action has to be done one time only, preferably in your main <code>loaded</code> function:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">me.pool.</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'laser'</span><span style="color: #C9D1D9">, EntityLaser, </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>Here we define <code>"laser"</code> as the unique identifier for the <code>EntityLaser</code> class in the entity pool. Also note that <code>true</code> is used as the last parameter to actually enable the object pooling for this particular entity type.</p>
<p>After this is done, we are ready to create new entities as before, with a slight difference on the object instantiation itself:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// Create a new laser object</span></span>
<span class="line"><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> myLaser </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> me.pool.</span><span style="color: #D2A8FF">pull</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'laser'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pos.x, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pos.y)</span></span>
<span class="line"><span style="color: #8B949E">// Add the laser to the game manager with z value 3</span></span>
<span class="line"><span style="color: #C9D1D9">me.game.world.</span><span style="color: #D2A8FF">addChild</span><span style="color: #C9D1D9">(myLaser, </span><span style="color: #79C0FF">3</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>As you can notice, we no longer directly instantiate the object but request a new instance of the entity identified by the <code>"laser"</code> id, which was declared to use our <code>EntityLaser</code> class.</p>
<p>One specific point of attention when using this is the object properties initialization, as you should carefully ensure that all of them are properly set/reset to their default value in the entity init method.</p>
<p>That’s it!</p>
<hr>
<h3 id="-5-handling-mouse-or-touch-events-on-multiple-overlapping-objects"><a name="overlapping_touches"></a> <strong>5. Handling mouse or touch events on multiple overlapping objects :</strong></h3>
<p>For most uses, the mouse/touch listeners will work great as long as the rects are in different parts of the screen. If any of them overlap you can run into trouble quickly. One obvious example is when registering mouse/touch events for the same <code>me.Rect</code> on multiple objects; wanting to use <code>me.game.viewport</code> is rather common.</p>
<p>The trouble starts when you want to release the event, because a callback isn’t provided to <code>me.input.releasePointerEvent()</code> specifying which callback should be released. Instead, it releases all callbacks on the provided <code>me.Rect</code>. (Side note: This may change in a future version of melonJS.)</p>
<p>As an immediate workaround, consider changing your code to register the event in a single “top level” object, and then delegate the event using the super awesome minpubsub!</p>
<p>First, the top-level event handler should be updated to only re-publish the event:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">me.input.</span><span style="color: #D2A8FF">registerPointerEvent</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #A5D6FF">'pointerdown'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    me.game.viewport,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        me.event.</span><span style="color: #D2A8FF">publish</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'pointerdown'</span><span style="color: #C9D1D9">, [event])</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">)</span></span></code></pre>
<p>Then setup some event listeners:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">me.event.</span><span style="color: #D2A8FF">on</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'pointerdown'</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pointerDown, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">)</span></span></code></pre>
<p>When you are ready to destroy the object which has an open subscription, you must unsubscribe:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">me.event.</span><span style="color: #D2A8FF">off</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.pointerDown)</span></span></code></pre>
<p>And you can safely destroy the event delegator when you no longer need to handle any mouse/touch events:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">me.input.</span><span style="color: #D2A8FF">releasePointerEvent</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'pointerdown'</span><span style="color: #C9D1D9">, me.game.viewport)</span></span></code></pre>
<hr>
<h3 id="-6-using-form-inputs-in-your-game"><a name="form_inputs"></a> <strong>6. Using form inputs in your game :</strong></h3>
<p>You have the option of positioning and styling the HTML elements using CSS. Using the HTML elements will take care of all kinds of corner cases for you: basic navigation features using keyboard and mouse input. Even things you necessarily don’t have to think about, like focus, tab selection, copy+paste, scrolling, etc. And on Mobile, using native HTML form elements relieve you of reimplementing the virtual keyboard, since the native keyboard only appears when an HTML text element is focused!</p>
<p>The HTML form elements also provide pretty simple APIs to get and manipulate their values. Especially if you are already using a library like jQuery.</p>
<p>Here’s a class that implements a text input, using jQuery to simplify the code:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">TextInput</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Renderable</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">constructor</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">x</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">y</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">type</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">length</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(x, y, length, </span><span style="color: #79C0FF">16</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.$input </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">$</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'&#x3C;input type="'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> type </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'" required>'</span><span style="color: #C9D1D9">).</span><span style="color: #D2A8FF">css</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #A5D6FF">"left"</span><span style="color: #C9D1D9"> : x,</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #A5D6FF">"top"</span><span style="color: #C9D1D9"> : y</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">switch</span><span style="color: #C9D1D9"> (type) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"text"</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.$input</span></span>
<span class="line"><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">attr</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"maxlength"</span><span style="color: #C9D1D9">, length)</span></span>
<span class="line"><span style="color: #C9D1D9">                .</span><span style="color: #D2A8FF">attr</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"pattern"</span><span style="color: #C9D1D9">, </span><span style="color: #A5D6FF">"[a-zA-Z0-9_</span><span style="color: #79C0FF">\-</span><span style="color: #A5D6FF">]+"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">case</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">"number"</span><span style="color: #C9D1D9">:</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.$input.</span><span style="color: #D2A8FF">attr</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"max"</span><span style="color: #C9D1D9">, length);</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">break</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #D2A8FF">$</span><span style="color: #C9D1D9">(me.video.</span><span style="color: #D2A8FF">getParent</span><span style="color: #C9D1D9">()).</span><span style="color: #D2A8FF">append</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.$input);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FFA657">onDestroyEvent</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FFA657">function</span><span style="color: #C9D1D9"> () {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.$input.</span><span style="color: #D2A8FF">remove</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span></code></pre>
<p>The real magic comes from using CSS to position the elements as expected within the viewport:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #79C0FF">#screen</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">position</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">relative</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #79C0FF">#screen</span><span style="color: #C9D1D9"> </span><span style="color: #7EE787">input</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">position</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">absolute</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">z-index</span><span style="color: #C9D1D9">: </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>You can also style the HTML inputs with background and font-color, font styles, border styles, etc. to better match your game.</p>
<p>And of course you can always manipulate the HTML element contents using the jQuery element reference, eg. with <code>this.$input.val()</code> and so on.</p>
<hr>
<h3 id="-7-resolving-collisions-properly"><a name="collisions"></a> <strong>7. Resolving collisions properly :</strong></h3>
<p>Collision detection is hard! The naïve approach to detecting collisions in a pixel-perfect manner is identical to the naïve approach of detecting collisions in a tile grid. The only difference between these cases is granularity; the area of a “solid” rectangle, and the tradeoff is how fast it can run with different granularities. As it turns out, the naïve approach is also the easiest to understand and implement.</p>
<p>Naïve collision detection checks for overlaps between two rectangles. That might be a sprite rectangle overlapping a tile, or a pixel overlapping another pixel; it’s just a matter of granularity! This is called an <a href="http://en.wikipedia.org/wiki/Minimum_bounding_box#Axis-aligned_minimum_bounding_box">AABB test</a>, and it involves comparing the top, left, right, and bottom coordinates of both rectangles in end-end order: top&#x3C;=>bottom, bottom&#x3C;=>top, left&#x3C;=>right, right&#x3C;=>left. That’s four comparisons total. It’s pretty fast when the granularity is large!</p>
<p>With melonJS, we want the best of both worlds; the accuracy of pixel-perfect collision detection with very high performance. To achieve this, the engine uses a combination of algorithms; <a href="http://en.wikipedia.org/wiki/Quadtree">QuadTree</a>, AABB tests, <a href="http://en.wikipedia.org/wiki/Hyperplane_separation_theorem#Use_in_collision_detection">SAT</a> … in roughly that order. QuadTree allows fast lookups of <em>nearby</em> objects which are candidates for collisions, the AABB test further filters objects that are definitely not colliding, and SAT performs very fast pixel-perfect collisions against arbitrary polygons and circles.</p>
<p>But wait! Collision <em>detection</em> is only one part of the issue. The other part is how objects <em>respond</em> to collisions. Some objects are solid, so no object may pass through them. Other objects are only there to trigger events when another object touches it (but may freely move through the object). The finish line on a race course is one example of the latter; you don’t want cars to run into the finish line like a brick wall. But you do want the race to end when the player’s car crosses the finish line, and that is triggered by collision detection.</p>
<p>Collision responses aren’t even that black-and-white! The Platformer Example implements platform objects that players can pass through, jump through, land on, and drop down from. Maybe you want some objects to be “squishy” instead of solid concrete… Whatever the case, these responses are all taken care of by collision handlers. In melonJS, the collision handler is <a href="http://melonjs.github.io/melonJS/docs/me.Entity.html#onCollision"><code>me.Entity.onCollision</code></a>. It’s a callback that accepts two arguments: <code>response</code> and <code>other</code>, and the return value is a Boolean that informs melonJS whether the response should be <em>applied</em> (<code>true</code>) or <em>ignored</em> (<code>false</code>). <code>response</code> is a <a href="http://melonjs.github.io/melonJS/docs/me.collision.html#ResponseObject"><code>me.collision.ResponseObject</code></a>, and <code>other</code> is just a reference to the other entity that is overlapping.</p>
<p>While melonJS does a decent job at handling collision responses by default in a sane manner, there are some things that will throw you off-guard if you are not prepared. Here’s the list of collision gotchas:</p>
<ul>
<li>
<p>An Entity that moves too fast will pass through solid shapes, and may be accelerated even faster if a collision occurs on the wrong side. This is the oldest open ticket: <a href="https://github.com/melonjs/melonJS/issues/16">#16</a> A solution is described in a (now-closed) ticket, regarding the use of the Entity’s range-of-motion instead of simply its AABB during the initial filtering phase: <a href="https://github.com/melonjs/melonJS/issues/103">#103</a></p>
</li>
<li>
<p>When a moving Entity hits the corner of a solid world shape, it has a chance of “bumping” to the side instead of coming to a dead stop. The “bumping” is perpendicular to the direction of momentum as described in <a href="https://groups.google.com/d/msg/melonjs/mteMY5EydAw/8BEjf2fKLSUJ">this forum post</a>. It’s caused by SAT choosing the “shortest depth” of the overlap for use as the collision response vector. When dealing with velocities that are high enough to penetrate into a rectangle more than the corner it clips, the “shortest depth” will be perpendicular to the momentum. It can be fixed by choosing a better heuristic than “shortest depth” in the collision handler, e.g. direction of momentum always wins over “shortest depth”.</p>
</li>
<li>
<p>The “shortest depth” heuristic also causes Entities to slowly slide down slopes when gravity is enabled. This is described in detail in <a href="https://groups.google.com/d/msg/melonjs/fSvQ728YYW8/BfABpcwJZsAJ">another forum post</a>, along with a suggested solution that forces the collision response upward instead of left or right.</p>
</li>
<li>
<p>Collision shapes with aligned edges (like rectangles that cover adjacent tiles) can cause moving Entities to get stuck on the inner corners as the Entity slides across what should be a flat surface. This is a well-known problem where “internal edges” confuse the collision <em>detection</em> system because collision responses are not applied simultaneously to all overlapping shapes, but individually, one-at-a-time. The general fix is using larger collision shapes, but a second solution is provided in <a href="https://groups.google.com/forum/#!msg/melonjs/_bvI0Ksc04U/DsrKHWpl_MMJ">this forum post</a> which describes a method of velocity limiting against the colliding axis to prevent collisions with internal edges.</p>
</li>
</ul></main>
    </body></html>